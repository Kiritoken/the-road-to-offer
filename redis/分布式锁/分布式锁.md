# 分布式锁

[https://blog.csdn.net/qq_35240226/article/details/82981031](https://blog.csdn.net/qq_35240226/article/details/82981031)

## 重要考量点
+ 互斥
+ 不能死锁
+ 容错（只要大部分redis节点创建了这把锁就可以）


## redis分布式锁

## zookeeper分布式锁
zk 分布式锁，其实可以做的比较简单，就是某个节点尝试创建临时 znode，此时创建成功了就获取了这个锁；这个时候别的客户端来创建锁会失败，只能注册个监听器监听这个锁。释放锁就是删除这个 znode，一旦释放掉就会通知客户端，然后有一个等待着的客户端就可以再次重新加锁。


获取锁的时候尝试获取一个临时节点，如果这个节点不存在那么就创建成功；
如果已经存在，说明别人已经占有，那么就失败，对这个临时节点注册一个监听器；
释放锁将临时节点即可；
临时节点被删除，zk就会通知监听的节点


## 优缺点
+ redis 分布式锁，其实需要自己不断去尝试获取锁，比较消耗性能
+ zk 分布式锁，获取不到锁，注册个监听器即可，不需要不断主动尝试获取锁，性能开销较小
