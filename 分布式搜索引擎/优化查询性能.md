# 如何优化查询性能

es在数据量很大的情况下（数十亿级别）如何提高查询效率？

## fileSystem cache(OS cache)
写数据的时候会先写buffer，每个一秒刷一个segemnt file到os cache中的segement中去，
***查询的时候，操作系统会将磁盘文件里的数据自动缓存到 filesystem cache 里面去***
es 的搜索引擎严重依赖于底层的 filesystem cache ，你如果给 filesystem cache 更多的内存，尽量让内存可以容纳所有的 idx segment file 索引数据文件，那么你搜索的时候就基本都是走内存的，性能会非常高。
***走磁盘肯定是秒级别的 ***

## 缓存预热
对于那些你觉得比较热的、经常会有人访问的数据，最好做一个专门的缓存预热子系统，就是对热数据每隔一段时间，就提前访问一下，让数据进入 filesystem cache 里面去。这样下次别人访问的时候，性能一定会好很多。
***搜索相当于会load到Filesystem cache中去。***

## 冷热分离
es 可以做类似于 mysql 的水平拆分，就是说将大量的访问很少、频率很低的数据，单独写一个索引，然后将访问很频繁的热数据单独写一个索引。最好是将冷数据写入一个索引中，然后热数据写入另外一个索引中，这样可以确保热数据在被预热之后，尽量都让他们留在 filesystem os cache 里，别让冷数据给冲刷掉。

## document 模型设计
es里的数据模型
写入的时候就完成join操作

## 分页优化
在不允许随机页数的情况下，考虑使用scroll